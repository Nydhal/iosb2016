
<!doctype html>
<html>
<head>
    <title>social media tool</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />



    <!-- http://www.cssscript.com/pure-css-circular-percentage-bar/ -->
    <link rel="stylesheet" href="circle.css">
    <style type="text/css">

    @import url(https://fonts.googleapis.com/css?family=Lato:300);

    /* some rgb to try */

        body {
            /*background-color:#ba9b03;*/
            background-color:#c490de;
            /*background-color:#f0d8f6;*/
            /*background-color:#f5ebfa;*/
            height:100%;
            width:100%;
            overflow:hidden;
            margin:0;
            padding:0;
        }

        #logo {
            position:fixed;
            left: 5%;
            bottom: 5%;
            /*opacity: 0.9;*/
            /*width: 15%;*/
            /*height: calc(0.87 * 15%);*/
            z-index:9999;
        }

        /* Remove blue outline from buttons */
        button:focus {outline:0;}



        /* PAGES (For background color) */

        /* INPUT PAGE */

        #inputPage {
            position:relative;
            background-color:#D0E1D4;

        }

        /* RESULTS PAGE */

        #resultsPage {
            position:relative;
            /*background-color:rgb(189,21,80);*/
            background-color:#64A6BD;
        }

        /* TOP POSTS PAGE */

        #topPostsPage {
            position:relative;
            background-color:#D0E1D4;
        }

        /* DATA PAGE */

        #dataPage {
            position:relative;
            background-color:#64A6BD;
        }

        /* EMOTION PAGE */

        #emotionsPage {
            position:relative;
            background-color:#D0E1D4;
        }




        /* STYLING FOR OBJECTS ON PAGES */

        /*INPUT PAGE */

        #postInputTextArea {
            position:relative;
            width:60%;
            height:50%;
            margin-top:7%;
            left:20%;
            border-radius:12px;
            border-color:rgba(255,255,255,0.45);
            border-width:2px;
            resize: none;
            background-color:rgba(255,255,255,0.55);

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;

        }

        #finishInputButton {
            position:absolute;
            border-radius:32px;
            top:75%;
            width:20%;
            height:10%;
            left:40%;
            background-color:#A7DBD8;
            color:#000000;
            font-family: Lato, Helvetica, sans-serif;
            font-size:2em;
            font-weight: bold;
        }


        /* RESULTS PAGE */


        #resultsMessageContainer {
            position:absolute;
            width:30%;
            height:65%;
            top:25%;
            left:55%;
            background-color: transparent;
            /*border-radius:3co2px;*/
            white-space: pre-wrap;
            display:table;

            border-width: 2px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;

            /* make div scrollable for tweets */
            overflow-y:auto;
        }

        #trendsList {
            position:absolute;
            /*background-color:black;*/
            width:90%;
            left:0%;
            overflow-y:auto;
            height:85%;
        }

        #trendingMessageContainer {
            position:absolute;
            width:30%;
            height:10%;
            top:12.5%;
            left:55%;
            background-color: transparent;
            /*border-radius:3co2px;*/
            white-space: pre-wrap;
            display:table;

            border-width: 2px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;


        }

        .resultsMetric {
            position:absolute;
            left:15%;
            top:10%;
            font-family: Lato, Helvetica, sans-serif;
            font-weight: bold;

        }


        /* TOP TWEETS PAGE */


        #tweets {

            position:relative;
            width:70%;
            height:65%;
            top:15%;
            bottom: 15%;
            right:15%;
            left:15%;
            line-height: 200%;
            margin-top: 32px;
            background-color: transparent;
            
            white-space: pre-wrap;

            display:table;

            border-width: 2px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;
        }


        /* BAR GRAPH FOR ONE PAGE */

        #leftpart {

            position:absolute;
            width:30%;
            height:30%;
            margin-top:2%;
            margin-bottom: 5%;
            margin-right:5%;
            margin-left:20%;

            background-color: transparent;

            border-width: 2px;
            border-style: solid;
            border-color: rgba(255,255,255,0.0);

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;
        }


        #rightpart {

            position:absolute;
            width:30%;
            height:65%;
            margin-top:0%;
            margin-bottom:5%;
            margin-right:5%;
            margin-left:60%;

            background-color: transparent;

            border-width: 2px;
            border-style: solid;
            border-color: rgba(255,255,255,0.0);

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;
        }

        #TitleText {
            position:absolute;
            width:70%;
            height:15%;
            top:5%;
            left:15%;
            right:15%;
            margin-bottom: 5%;

            background-color: transparent;
            
            white-space: pre-wrap;
            display:table;

            border-width: 0px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:2em;
        }

        .bars{

            position:relative;
            width:90%;
            height:10%;
            margin-top: 4%;
            margin-bottom: 4%;
            margin-left: 2%; 
            border-width: 2px;
            border-color:rgba(124,119,195,0.8);
            border-style: solid;


        }

        .inneritem{

            background-color: #7c77c3;
            height:100%;
            width:50%;
            left:0%;

        }



        body {
          background: #efefef;
        }

        #chart {
          text-align: left;
          box-shadow: 0px 2px 8px rgba(0,0,0,0);
          border: 0px transparent #aaa;
          margin: 32px auto;
          margin-left: 20%;
          background: transparent;
        }

        .trafficLight {
            position:relative;
            left:0%;
            height:100%;
            width:100%;
        }

        #seeMoreDataButton {
            position:absolute;
            border-radius:32px;
            top:80%;
            width:20%;
            height:10%;
            left:33%;
            background-color:#A7DBD8;
            color:#000000;
            font-family: Lato, Helvetica, sans-serif;
            font-size:2em;
            font-weight: bold;
        }

        #seeSuggestionsButton {
            position:absolute;
            border-radius:32px;
            top:80%;
            width:20%;
            height:10%;
            left:33%;
            background-color:#A7DBD8;
            color:#000000;
            font-family: Lato, Helvetica, sans-serif;
            font-size:2em;
            font-weight: bold;
        }


        /* http://stackoverflow.com/questions/351058/space-between-two-rows-in-a-table */
        /* Apply padding to td elements that are direct children of the tr element. */
        tr.spaceUnder > td
        {
          padding-bottom: 14%;
        }


    </style>


<body>


    <!-- JOURNAL ENTRY PAGE -->
    <div id="inputPage">

        <a class="scroll" href="#dataPage"> back 1 </a> <br>
        <a class="scroll" href="#resultsPage"> forward </a>
        <div id="TitleText">
            <span style="display:table-cell; vertical-align:middle; text-align:center; padding-left:5%; padding-right:5%">Hello, my name is Soshi! let me see what you want to share:</span>
        </div>
        <br> <br>
        <textarea id="postInputTextArea"></textarea>

        <button id="finishInputButton"> Let's go! </button>

        <img id="logo" src="img/cute.png" >

    </div>



    <!-- ENTRY RESULTS -->
    <div id="resultsPage">

        <a class="scroll" href="#inputPage"> back 1 </a> <br>
        <a class="scroll" href="#dataPage"> forward 1 </a> <br>

        <div id="trendingMessageContainer">
             <span style="display:table-cell; vertical-align:middle; padding-left:5%; padding-right:5%" id="isTrendingText"></span>
        </div>

        <div id="resultsMessageContainer">
            <span style="display:table-cell; padding-left:5%; padding-right:5%; padding-top:5%">Here are the top Trends:</span>
            <br>
            <ul id="trendsList"></ul>
        </div>

        <div class="c100 big dark resultsMetric" id="percent">
          <span id="viralityPercentText">25%</span>
          <div class="slice">
            <div class="bar"></div>
            <div class="fill"></div>
          </div>
        </div>

        <a class="scroll" href="#dataPage"><button id="seeMoreDataButton"> See More Data! </button></a>



    </div>



    <div id="dataPage">

        <a class="scroll" href="#resultsPage"> back 1 </a> <br>
        <a class="scroll" href="#emotionsPage"> forward 1 </a>


        <div id="leftpart">
<!--             <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%, margin-bottom:20%">Readability:</span>
            <div class= "bars">
                <div class="inneritem" id="readabilityBar"></div>
            </div>

            <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%; margin-bottom:20%">Impactful Words:</span>
            <div class= "bars" >
                <div class="inneritem" id="powerWordsBar"></div>
            </div>

            <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%; margin-bottom:20%">Links, Emoticons, and Punctuation:</span>
            <div class= "bars" >
                <div class="inneritem" id="emoticonsAndLinksBar"></div>
            </div> -->

            <table  style="width:100%; height:100%; padding-bottom:30%;">
              <tr class="spaceUnder">
                <td><span style="font-family:helvetica"><b>Readability:</b></span></td>
                <td><img src="img/HALF.png" class="trafficLight" id="readabilityLight"></td>
                
              </tr>
              <tr class="spaceUnder">
                <td><span style="font-family:helvetica"><b>Impactful Words:</b></span></td>
                <td><img src="img/HALF.png" class="trafficLight" id="powerWordsLight"></td> 
                
              </tr>
              <tr >
                <td><span style="font-family:helvetica"><b>Links, Emoticons, and Punctuation:</b></span></td> 
                <td><img src="img/HALF.png" class="trafficLight" id="linksAndEmoticonsLight"></td>
                
              </tr>
            </table>

            <!-- <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%, margin-bottom:20%">Readability:</span> -->
            <!-- </br> -->
            <!-- <img src="img/HALF.png" class="trafficLight"> -->
            <!-- <br></br> -->
            <!-- <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%; margin-bottom:20%">Impactful Words:</span> -->
            <!-- </br> -->
            <!-- <img src="img/HALF.png" class="trafficLight"> -->
            <!-- <br></br> -->
            <!-- <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%; margin-bottom:20%">Links, Emoticons, and Punctuation:</span> -->
            <!-- </br> -->
            <!-- <img src="img/HALF.png" class="trafficLight"> -->

        </div>
        <div id="rightpart">


            <div style="position:static; height:30%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;" id="readabilityResult">Suggestion1</span>
            </div>
            <br>

            <div style="position:static;height:30%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;" id="powerWordsResult">Suggestion2</span>
            </div>

            <br>
            <div style="position:static;height:30%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;" id="emoticonsAndLinksResult">Suggestion3</span>
            </div>
            <br></br>



                
        </div>

        <a class="scroll" href="#emotionsPage"><button id="seeSuggestionsButton"> Emotional Context! </button></a>

    </div>


    <div id="emotionsPage">

        <a class="scroll" href="#dataPage"> back 1 </a> <br>
        <a class="scroll" href="#topPostsPage"> forward 1 </a>
        <div id="chart">        <div id="rightpart">
            <div style="position:static; height:20%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;" id="readabilityResult">Suggestion1</span>
            </div>
        </div></div>


        
    </div>







    <div id="topPostsPage">

        <a class="scroll" href="#emotionsPage"> back 1 </a> <br>
        <a class="scroll" href="#inputPage"> forward 1 </a>

        <div id="TitleText">
            <span style="display:table-cell; vertical-align:middle; text-align:center; padding-left:5%; padding-right:5%">Top tweets in your topic!</span>
        </div>

        <div id="tweets">
        <span style=" vertical-align:center; padding-left:5%; padding-bottom:5%; padding-right:5%">"Tweet 1 ...."</span>
    </br>
        <span style=" vertical-align:center; padding-left:5%; padding-bottom:5%; padding-right:5%">"Tweet 2 ...."</span>
        </div>

    </div>






<script src="jquery.min.js"></script>
<script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
<script src="spin.min.js"></script>
<script src="jquery.rotate.1-1.js"></script>
<script src="features.js"></script>
<script src="emojis.js"></script>
<!-- <script src="Chart/src/chart.js"></script> -->
<!-- <script src="./bundle.js"></script> -->

<script>



    // SETUP

    // FIREBASE
    var rootRef = "https://sbio2016.firebaseio.com/";
    var trendsRef = rootRef + "trending";
    var trendsFirebase = new Firebase(trendsRef);
    var currPostRef = rootRef + "currPost/text";
    var currPostFirebase = new Firebase(currPostRef);
    var currPostToneFirebase = new Firebase(rootRef + "curr_post_tone")

    // PAGES
    var pageIDs = ["#inputPage", "#resultsPage", "#topPostsPage", "#dataPage", "#emotionsPage"];

    // VARIABLES
    var currInput = "";
    var isTrending = false;
    var coefficients = {};
    var viralityScore = 0;
    var emoticons = splitEmoticonsIntoArrayOfStrings();
    var containsEmoticons = false;
    var containsLinks = false;

   // Smooth scroll
    jQuery(document).ready(function($) {
        $(".scroll").click(function(event){     
            event.preventDefault();
            $('html,body').animate({scrollTop:$(this.hash).offset().top}, 500);
        });
    });


    // Page setup
    function resizeHelper() {
        var winheight = $(window).height();
        var winwidth = $(window).width();

        for (var i = 0; i < pageIDs.length; i++) {
            $(pageIDs[i]).height(winheight);
            $(pageIDs[i]).width(winwidth);
        }
    }

    $(window).on('resize', function(){
        resizeHelper();
    }).trigger('resize');


    window.onload = load();

    function load() {
        console.log("loaded");
        resizeHelper();
        window.scrollTo(0,0);
    }





    // INPUT PAGE

    // Handle tabbing in text area
    // Note this isn't great for blind folks
    // http://stackoverflow.com/questions/6637341/use-tab-to-indent-in-textarea
    $(document).delegate('.textbox', 'keydown', function(e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode == 9) {
        e.preventDefault();
        var start = $(this).get(0).selectionStart;
        var end = $(this).get(0).selectionEnd;

        // set textarea value to: text before caret + tab + text after caret
        $(this).val($(this).val().substring(0, start)
                    + "\t"
                    + $(this).val().substring(end));

        // put caret at right position again
        $(this).get(0).selectionStart =
        $(this).get(0).selectionEnd = start + 1;
      }
    });

    $( "#finishInputButton" ).click(function() {

        // currPostFirebase = new Firebase(firebaseRoot + "/" + n)
        // currPostFirebase.set({"entryPath":n, "entryText": currPostText})

        // $("#overlay").css({'background-color':'transparent'});
        // $("#overlay").show();
        // setTimeout("endLoadingToNewScreen()", (3000));
        showResults();

    });

    function showResults() {
        // Get the data and parse it
        currInput = $("#postInputTextArea").val();
        currPostFirebase.set(currInput);
        // alert(currInput);

        // $('#overlay').fadeOut( 400 );
        // var keywordsFound = checkForKeywords();

        // getCurrentPostData();

        // if (!keywordsFound) {
        //     setTimeout("moveToResultsScreen()", 400);
        // }
        logoWiggle();

        // setTimeout("")
        setTimeout("moveToResultsPage()", 1200);
    
    }

    function moveToResultsPage() {
        if (checkForTrends()) {
            $("#isTrendingText").html("Your post is: <span style=\"color:green; font-weight:bold;\"> trending! </span>");
            isTrending = true;
        } else {
            $("#isTrendingText").html("Your post is: <span style=\"color:red; font-weight:bold;\"> not trending. </span>");
            isTrending = false;
        }
        coefficients = returnCoefficients(currInput);
        checkForLinksAndEmoji();
        setBarValues();
        setResultMessages();
        getCurrentPostData();
        setTimeout("setViralityScore()", 800);
        setTimeout("finishMove()", 800);

        
    }

    function finishMove() {
        $('html,body').animate({scrollTop:$("#resultsPage").offset().top}, 500);
    }

    function logoWiggle() {
        smoothRotateLeft(0, 2);
        setTimeout("smoothRotateRight(0, 2)", 160);
        setTimeout("smoothRotateRight(0, 2)", 320);
        setTimeout("smoothRotateLeft(0, 2)", 480);
        setTimeout("smoothRotateLeft(0, 2)", 640);
        setTimeout("smoothRotateRight(0, 2)", 700);
        setTimeout("smoothRotateRight(0, 2)", 860);
        setTimeout("smoothRotateLeft(0, 2)", 1020);
        setTimeout("smoothRotateLeft(0, 2)", 1180);
        setTimeout("smoothRotateRight(0, 2)", 1340);
        setTimeout("smoothRotateRight(0, 2)", 860);
        setTimeout("smoothRotateLeft(0, 2)", 1020);
    }

    function smoothRotateLeft(deg, amt) {
        $("#logo").rotateLeft(amt);
        if (deg < 5) {
            deg = deg + 4;
            setTimeout("smoothRotateLeft(" + deg + "," + amt + ")", 8);
            console.log("left: ", amt, " deg: ",deg);
        }
    }
    function smoothRotateRight(deg, amt) {
        $("#logo").rotateRight(amt);
        if (deg < 5) {
            deg = deg + 4;
            setTimeout("smoothRotateRight(" + deg + "," + amt + ")", 8);
            console.log("right: ", amt, " deg: ",deg);
        }
    }


    function moveToResultsScreen() {
        // // set bar graph
        // setBarHeightsForTones(currPostData);
        // setResponseMessage();
        // getInsightsData();
        // // set the message
        // getLastFivePosts();
        // console.log("LAST FIVE POSTS");
        // console.log(lastFiveEntries);
        // generateLineGraph("Anger");

        // $('html,body').animate({scrollTop:$("#entryStatsPage").offset().top}, 500);
        // console.log(currPostData);

        // setTimeout("setPersonalityBarHeights()", 1000);
    }


// $("#resultsMessageContainer span").text(message);



    // Some FIREBASE STUFF
    var trendsAry = [];
    setTimeout("getTrends()", 1000);
    function getTrends() {
        trendsFirebase.once("value", function(snapshot) {
            // alert(JSON.stringify(snapshot.val(), null, 2));
            var trends = snapshot.val();
            for (var ndx in trends) {
                var trend = trends[ndx].name;
                if (trends[ndx].tweet_volume != undefined) {
                   var volume = trends[ndx].tweet_volume;
                }
                else {
                    var volume = "< 10000";
                }
                var link = trends[ndx].url
                var str = "Trend: \"" + "<a target='blank' href='" + link + "'>" + trend + "</a>"+ "\"\nTweet volume: " + volume;
                $("#trendsList").append("<li>" + str+"</li>" + "<br>");
                trendsAry.push(trend);
            }
        });
    }

    //check for trends in the post
    function checkForTrends() {
        var currPost = currInput.toLowerCase();
        var currTrend = "";
        for (var i = 0; i < trendsAry.length; i++) {
            if ((trendsAry[i].charAt(0) == "#") || (trendsAry[i].charAt(0) == "@")) {
                // console.log("trend: ",trendsAry[i], " it was #")
                currTrend = trendsAry[i].substring(1).toLowerCase();
            }
            else {
                currTrend = trendsAry[i].toLowerCase();
            }
            if (currPost.indexOf(currTrend) > -1) {
                return true;
            }
        }
        return false;
    }



    function checkForLinksAndEmoji() {
        for (var i = 0; i < emoticons.length; i++) {
            if (currInput.indexOf(emoticons[i]) > -1) {
                containsEmoticons = true;
            }
        }
        if (containsEmoticons) {
            coefficients["EmoticonsAndLinksScore"] = 5;
            coefficients["EmoticonsAndLinksLevel"] = 33;
        }
        else {
            coefficients["EmoticonsAndLinksScore"] = 0;
            coefficients["EmoticonsAndLinksLevel"] = 0;
        }

        if (new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?").test(currInput)) {
            // alert("url inside");
            coefficients["EmoticonsAndLinksScore"] += 10;
            coefficients["EmoticonsAndLinksLevel"] += 67;
            containsLinks = true;
        }
        else {
            // do nothing
        }


    }

    function setViralityScore() {
        // alert(viralityScore);
        if (isTrending) {
            viralityScore += 20;
        }
        // console.log("\n\n\n\n\n" + coefficients + "\n\n\n\n\n\n");
        viralityScore += coefficients["FKGradeScore"];
        // alert(viralityScore);
        viralityScore += coefficients["PowerWordsScore"];
        // alert(viralityScore);
        viralityScore += coefficients["EmoticonsAndLinksScore"];
        // alert(viralityScore);
        viralityScore += parseFloat(coefficients["EmotionScore"].toFixed(2));
        // alert(viralityScore);
        var rounded = Math.round(viralityScore);
        // alert(coefficients["EmotionScore"].toFixed(2))
        // alert(viralityScore);

        $("#percent").addClass("p" + rounded);
        $("#viralityPercentText").text(viralityScore.toFixed(2) + "%")
    }

    function setBarValues() {
        // $("#readabilityBar").css("width",coefficients["FKGradeLevel"].toString() + "%");
        // $("#powerWordsBar").css("width",coefficients["PowerWordsLevel"].toString() + "%");
        // $("#emoticonsAndLinksBar").css("width",coefficients["EmoticonsAndLinksLevel"].toString() + "%");
    }

    function setResultMessages() {
        setReadabilityMessage();
        setPowerWordsMessage();
        setLinksAndEmoticonsMessage();
    }

    function setReadabilityMessage() {
        if (coefficients.FKGradeScore == 5) {
            var result = "Your post is hard to read.";
            var suggestion = "Try using simpler words!";
            $("#readabilityLight").attr("src","img/NO.png");

        }
        else if (coefficients.FKGradeScore == 10) {
            var result = "Your post is a bit simple.";
            var suggestion = "Try adding some descriptive words!";
            $("#readabilityLight").attr("src","img/HALF.png");
        }
        else if (coefficients.FKGradeScore == 15) {
            var result = "Your post is easy to read.";
            var suggestion = "Great job!";
            $("#readabilityLight").attr("src","img/YES.png");
        }
        var str = result.concat("<br><br>" + suggestion);
        $("#readabilityResult").html(str);
    }

    function setPowerWordsMessage() {
        var powerwords = getRandomPowerWords();
        if (coefficients.PowerWordsScore == 0) {
            var result = "Your post needs more impactful words.";
            var suggestion = "Try using some of these: ";
            suggestion = suggestion.concat(powerwords[0]);
            for (var i = 1; i < powerwords.length; i++) {
                suggestion = suggestion.concat(", " + powerwords[i]);
            }
            suggestion = suggestion.concat("!")
            $("#powerWordsLight").attr("src","img/NO.png");
        }
        else if (coefficients.PowerWordsScore == 10) {
            var result = "Your post has one impactful word, but it could be better!";
            var suggestion = "Try using some of these: ";
            suggestion = suggestion.concat(powerwords[0]);
            for (var i = 1; i < powerwords.length; i++) {
                suggestion = suggestion.concat(", " + powerwords[i]);
            }
            suggestion = suggestion.concat("!")
            $("#powerWordsLight").attr("src","img/HALF.png");
        }
        else if (coefficients.PowerWordsScore == 20) {
            var result = "Your post has plenty of impactful words!";
            var suggestion = "You rock!";
            $("#powerWordsLight").attr("src","img/YES.png");
        }
        var str = result.concat("<br><br>" + suggestion);
        $("#powerWordsResult").html(str);
    }

    function setLinksAndEmoticonsMessage() {
        if (coefficients.EmoticonsAndLinksScore == 0) {
            var result = "Your post could use more variety.";
            var suggestion = "Try adding a link and an exclamation, a question, or an emoticon! :)";
            $("#linksAndEmoticonsLight").attr("src","img/NO.png");
        }
        else if (coefficients.EmoticonsAndLinksScore == 5) {
            var result = "Your post needs something for people to explore.";
            var suggestion = "Try adding a link!";
            $("#linksAndEmoticonsLight").attr("src","img/HALF.png");
        }
        else if (coefficients.EmoticonsAndLinksScore == 10) {
            var result = "Your post needs some more emphasis.";
            var suggestion = "Try adding a question, an exclamation, or an emoticon! :)";
            $("#linksAndEmoticonsLight").attr("src","img/HALF.png");
        }
        else if (coefficients.EmoticonsAndLinksScore == 15) {
            var result = "Your post has a link and good depth.";
            var suggestion = "You're awesome!";
            $("#linksAndEmoticonsLight").attr("src","img/YES.png");
        }
        var str = result.concat("<br><br>" + suggestion);
        $("#emoticonsAndLinksResult").html(str);
    }





    $(function(){
      $('#chart').radarChart({
        size: [500, 500],
        step: 1,
        title: "Emotional Profile",
        values: {
          "Joy": 4.1,
          "Anger": 3.5,
          "Fear": 4,
          "Disgust": 3,
          "Sadness": 3,

        },
        showAxisLabels: true
      });
    });

    (function($) {
      
      var Radar = (function() {
        
        function Radar(ele, settings) {
          this.ele = ele;
          this.settings = $.extend({
            showAxisLabels: false,
            title: "Untitled",
            step: 1,
            size: [600,600],
            values: {},
            color: [0,128,255]
          },settings);
          this.width = settings.size[0];
          this.height = settings.size[1];
          $(ele).css({
            'position': 'relative',
            'width': this.width,
            'height': this.height
          });
          this.canvases = {};
          this.draw();
        }
        
        Radar.prototype.newCanvas = function(name, delay) {
          var delay = delay || 0;
          var canvas = document.createElement('canvas');
          canvas.width = this.width;
          canvas.height = this.height;
          $(canvas).css({
            'position': 'absolute'
          });
          this.canvases[name] = canvas;
          this.ele.appendChild(canvas);
          this.cxt = canvas.getContext('2d');
          if (delay != 0) {
            $(canvas).css('opacity',0).delay(delay).animate({opacity: 1}, 500);
          }
        }
        
        Radar.prototype.draw = function() {
          this.newCanvas('axis', 100);
          var min = 0;
          var max = 0;
          
          $.each(this.settings.values, function(i,val){
            if (val < min)
              min = val;
            if (val > max)
              max = val;
          });
          
          min = Math.floor(min);
          max = Math.ceil(max);

          var spacing = 30;
          
          for(var i = min; i <= max; i += this.settings.step) {
            this.cxt.beginPath();
            this.cxt.arc(this.width/2,
                         this.height/2,
                         this.settings.step * spacing * i,
                         0, 2 * Math.PI, false);
            this.cxt.strokeStyle = "#370784";
            this.cxt.fillStyle = "#370784";
            this.cxt.stroke();
            if (this.settings.showAxisLabels)
              this.cxt.fillText(i,this.width/2 + this.settings.step * spacing * i+4, this.height/2-2);
          }
          
          var size = 0;
          for(var key in this.settings.values)
            size += 1;
          
          for(var i = 0; i < size; i += 1) {
            this.cxt.beginPath();
            this.cxt.moveTo(this.width / 2, this.height /2);
            var x = this.width / 2 + Math.cos((Math.PI * 2) * (i / size)) * spacing * max;
            var y = this.height /2 + Math.sin((Math.PI * 2) * (i / size)) * spacing * max;
            this.cxt.lineTo(x, y);
            this.cxt.stroke();
          }
          
          this.newCanvas('part',200);
          
          this.cxt.beginPath();
          var first = true;
          var i = 0;
          var that = this;
          var end = {x: null, y: null};
          $.each(this.settings.values, function(key,val){
            var x = that.width / 2 + Math.cos((Math.PI * 2) * (i / size)) * spacing * val;
            var y = that.height / 2 + Math.sin((Math.PI * 2) * (i / size)) * spacing * val;
            if (first) {
              that.cxt.moveTo(x, y);
              end.x = x;
              end.y = y;
              first = false;
            }
            that.cxt.lineTo(x, y);
            i += 1;
          });
          
          this.cxt.lineTo(end.x, end.y);
          var grad = this.cxt.createLinearGradient(0, 0, 0, this.height);
          //grad.addColorStop(0,"rgba("+this.settings.color[0]+","+this.settings.color[1]+","+this.settings.color[2]+",0)");
          grad.addColorStop(1,"rgba("+this.settings.color[0]+","+this.settings.color[1]+","+this.settings.color[2]+",0.5)");
          this.cxt.fillStyle = grad;
          this.cxt.shadowBlur = 2;
          this.cxt.shadowColor = "rgba(0, 0, 0, 0.2)";
          //this.cxt.stroke();
          this.cxt.fill();
          
          this.newCanvas('labels',1000);
          
          i = 0;
          $.each(this.settings.values, function(key,val){
            that.newCanvas('label-'+i, i * 250);
            that.cxt.fillStyle = "rgba(0,0,0,.8)";
            that.cxt.strokeStyle = "rgba(0,0,0,.5)";
            that.cxt.font = "bold 16px Verdana";
            var dist = Math.min(spacing * val, size * spacing);
            var x = that.width / 2 + Math.cos((Math.PI * 2) * (i / size)) * spacing * val;
            var y = that.height / 2 + Math.sin((Math.PI * 2) * (i / size)) * spacing * val;

            var textX = that.width / 2 + Math.cos((Math.PI * 2) * (i / size)) * spacing * val;
            var textY = that.height / 2 + Math.sin((Math.PI * 2) * (i / size)) * spacing * val * 1.5;
            
            if (textX < that.width/2) {
              textX -= 75
              that.cxt.textAlign="end";
              that.cxt.beginPath();
              var width = that.cxt.measureText(key).width;
              that.cxt.moveTo(textX - width - 5, textY + 4);
              that.cxt.lineTo(textX + 15, textY + 4);
              that.cxt.lineTo(x - 2, y);
              that.cxt.lineWidth = 2;
              that.cxt.stroke();
            } else {
              textX += 75
              that.cxt.textAlign="start";
              that.cxt.beginPath();
              var width = that.cxt.measureText(key).width;
              that.cxt.moveTo(x + 2,y);
              that.cxt.lineTo(textX - 15, textY + 4);
              that.cxt.lineTo(textX + width + 5, textY + 4);
              that.cxt.lineWidth = 2;
              that.cxt.stroke();
            }
            that.cxt.fillText(key, textX, textY);
            //For arrows that aren't done.
            i += 1;
          });
          
          
          this.newCanvas('title',1000);
          this.cxt.font = "24px Verdana";
          this.cxt.fillText(this.settings.title, 10, 30); 
        }
        
        return Radar;
        
      })();
      
      $.fn.radarChart = function(settings){
        this.each(function(i,ele){
          var radar = new Radar(ele, settings);
        });
      }
      
    })(jQuery);




    // Data processing for current post
    var currPostEmotions = {};
    var currPostWriting = {};
    var currPostSocial = {};
    var currPostEmotionData;

    function calculateEmotionalWeight() {
        var keysSorted = Object.keys(currPostEmotions).sort(function(a,b){return currPostEmotions[a]-currPostEmotions[b]});
        console.log(keysSorted);

        var mean = 0;
        for (var i = 0; i < 4; i++) {
            mean += currPostEmotions[keysSorted[i]];
        }
        mean = mean / 4;
        var diff = currPostEmotions[keysSorted[keysSorted.length - 1]] - mean;
        var diffSquared = Math.sqrt(diff);
        console.log("MEAN: ",mean);
        console.log("DIFF: ", diff);
        console.log("DIFF SQUARED: ", diffSquared);
        coefficients["EmotionScore"] = diffSquared * 20;

        
    }

    function getCurrentPostData() {
        currPostToneFirebase.once("value", function(snapshot) {
            var postContents = snapshot.val();
            console.log(postContents);
            // var postTones = postContents.tone.document_tone.tone_categories[0].tones;
            // console.log(postContents.tone);
            // console.log(postContents.tone.document_tone);
            // console.log(postContents.tone.document_tone.tone_categories[0]);
            
            // currPostAnger = postTones[0].score;
            // console.log("THE ANGER IS " + currPostAnger.toString());
            // currPostData = processTonesIntoData(postTones);
            var postData = postContents.tone.document_tone;
            currPostEmotions = processTonesIntoData(postData.tone_categories[0].tones);
            currPostData = processPostData(postData);
            console.log(currPostData)

            calculateEmotionalWeight();
        });
    }

    function processTonesIntoData(tones) {
        // Will do it in sorted order

        var returnDict = {"Anger":0.0, "Disgust":0.0, "Fear":0.0, "Joy":0.0, "Sadness":0.0};
        returnDict.Anger = tones[0].score;
        returnDict.Disgust = tones[1].score;
        returnDict.Fear = tones[2].score;
        returnDict.Joy = tones[3].score;
        returnDict.Sadness = tones[4].score;
        return returnDict;
    }

    function processPostData(data) {

        var emotional_tones = data.tone_categories[0].tones;
        var writing_tones = data.tone_categories[1].tones;
        var social_tones = data.tone_categories[2].tones;

        var returnDict = {};

        // emotional tones
        returnDict["Anger"] = emotional_tones[0].score;
        returnDict["Disgust"] = emotional_tones[1].score;
        returnDict["Fear"] = emotional_tones[2].score;
        returnDict["Joy"] = emotional_tones[3].score;
        returnDict["Sadness"] = emotional_tones[4].score;

        // writing tones
        returnDict["Analytical"] = writing_tones[0].score;
        returnDict["Confident"] = writing_tones[1].score;
        returnDict["Tentative"] = writing_tones[2].score;

        currPostWriting["Analytical"] = writing_tones[0].score;
        currPostWriting["Confident"] = writing_tones[1].score;
        currPostWriting["Tentative"] = writing_tones[2].score;

        // social tones
        returnDict["Openness"] = social_tones[0].score;
        returnDict["Conscientiousness"] = social_tones[1].score;
        returnDict["Extraversion"] = social_tones[2].score;
        returnDict["Agreeableness"] = social_tones[3].score;
        returnDict["EmotionalRange"] = social_tones[4].score;

        currPostSocial["Openness"] = social_tones[0].score;
        currPostSocial["Conscientiousness"] = social_tones[1].score;
        currPostSocial["Extraversion"] = social_tones[2].score;
        currPostSocial["Agreeableness"] = social_tones[3].score;
        currPostSocial["EmotionalRange"] = social_tones[4].score;

        return returnDict;

    }

</script>

</body>
</html>
