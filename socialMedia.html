
<!doctype html>
<html>
<head>
    <title>social media tool</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />



    <!-- http://www.cssscript.com/pure-css-circular-percentage-bar/ -->
    <link rel="stylesheet" href="circle.css">
    <style type="text/css">

    @import url(https://fonts.googleapis.com/css?family=Lato:300);

    /* some rgb to try */

        body {
            /*background-color:#ba9b03;*/
            background-color:#c490de;
            /*background-color:#f0d8f6;*/
            /*background-color:#f5ebfa;*/
            height:100%;
            width:100%;
            overflow:hidden;
            margin:0;
            padding:0;
        }

        #logo {
            position:fixed;
            left: 5%;
            bottom: 5%;
            /*opacity: 0.9;*/
            /*width: 15%;*/
            /*height: calc(0.87 * 15%);*/
            z-index:9999;
        }

        /* Remove blue outline from buttons */
        button:focus {outline:0;}



        /* PAGES (For background color) */

        /* INPUT PAGE */

        #inputPage {
            position:relative;
            background-color:#D0E1D4;

        }

        /* RESULTS PAGE */

        #resultsPage {
            position:relative;
            /*background-color:rgb(189,21,80);*/
            background-color:#64A6BD;
        }

        /* TOP POSTS PAGE */

        #topPostsPage {
            position:relative;
            background-color:#D0E1D4;
        }

        /* DATA PAGE */

        #dataPage {
            position:relative;
            background-color:#64A6BD;
        }

        /* EMOTION PAGE */

        #emotionsPage {
            position:relative;
            background-color:#D0E1D4;
        }




        /* STYLING FOR OBJECTS ON PAGES */

        /*INPUT PAGE */

        #postInputTextArea {
            position:relative;
            width:60%;
            height:60%;
            top:5%;
            left:20%;
            border-radius:12px;
            border-color:rgba(255,255,255,0.45);
            border-width:2px;
            resize: none;
            background-color:rgba(255,255,255,0.55);

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;

        }

        #finishInputButton {
            position:absolute;
            border-radius:32px;
            top:75%;
            width:20%;
            height:10%;
            left:40%;
            background-color:#A7DBD8;
            color:#000000;
            font-family: Lato, Helvetica, sans-serif;
            font-size:2em;
            font-weight: bold;
        }


        /* RESULTS PAGE */


        #resultsMessageContainer {
            position:absolute;
            width:30%;
            height:65%;
            top:25%;
            left:55%;
            background-color: transparent;
            /*border-radius:3co2px;*/
            white-space: pre-wrap;
            display:table;

            border-width: 2px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;

            /* make div scrollable for tweets */
            overflow-y:auto;
        }

        #trendsList {
            position:absolute;
            /*background-color:black;*/
            width:90%;
            left:0%;
            overflow-y:auto;
            height:87%;
        }

        #trendingMessageContainer {
            position:absolute;
            width:30%;
            height:10%;
            top:12.5%;
            left:55%;
            background-color: transparent;
            /*border-radius:3co2px;*/
            white-space: pre-wrap;
            display:table;

            border-width: 2px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;


        }

        .resultsMetric {
            position:absolute;
            left:20%;
            top:15%;
            font-family: Lato, Helvetica, sans-serif;
            font-weight: bold;

        }


        /* TOP TWEETS PAGE */


        #tweets {

            position:relative;
            width:70%;
            height:65%;
            top:15%;
            bottom: 15%;
            right:15%;
            left:15%;
            line-height: 200%;
            margin-top: 32px;
            background-color: transparent;
            
            white-space: pre-wrap;

            display:table;

            border-width: 2px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;
        }


        /* BAR GRAPH FOR ONE PAGE */

        #leftpart {

            position:absolute;
            width:30%;
            height:65%;
            margin-top:2%;
            margin-bottom: 5%;
            margin-right:5%;
            margin-left:20%;

            background-color: transparent;

            border-width: 2px;
            border-style: solid;
            border-color: rgba(255,255,255,0.0);

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;
        }


        #rightpart {

            position:absolute;
            width:30%;
            height:65%;
            margin-top:2%;
            margin-bottom:5%;
            margin-right:5%;
            margin-left:60%;

            background-color: transparent;

            border-width: 2px;
            border-style: solid;
            border-color: rgba(255,255,255,0.0);

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:1.2em;
        }

        #TitleText {
            position:absolute;
            width:70%;
            height:15%;
            top:5%;
            left:15%;
            right:15%;
            margin-bottom: 5%;

            background-color: transparent;
            
            white-space: pre-wrap;
            display:table;

            border-width: 0px;
            border-style: solid;
            border-color: #7C77C3;

            color:#370784;
            font-family: Lato, Helvetica, sans-serif;
            font-weight:bold;
            font-size:2em;
        }

        .bars{

            position:relative;
            width:90%;
            height:10%;
            margin-top: 4%;
            margin-bottom: 4%;
            margin-left: 2%; 
            border-width: 2px;
            border-color:rgba(124,119,195,0.8);
            border-style: solid;


        }

        .inneritem{

            background-color: #7c77c3;
            height:100%;
            width:50%;
            left:0%;

        }



    </style>


<body>


    <!-- JOURNAL ENTRY PAGE -->
    <div id="inputPage">

        <a class="scroll" href="#dataPage"> back 1 </a> <br>
        <a class="scroll" href="#resultsPage"> forward </a>
        <div id="TitleText">
            <span style="display:table-cell; vertical-align:middle; text-align:center; padding-left:5%; padding-right:5%">Hello, my name is Soshi! let me see what you have to share:</span>
        </div>
        <br> <br>
        <textarea id="postInputTextArea"></textarea>

        <button id="finishInputButton"> Let's go! </button>

        <img id="logo" src="img/cute.png" >

    </div>



    <!-- ENTRY RESULTS -->
    <div id="resultsPage">

        <a class="scroll" href="#inputPage"> back 1 </a> <br>
        <a class="scroll" href="#dataPage"> forward 1 </a> <br>

        <div id="trendingMessageContainer">
             <span style="display:table-cell; vertical-align:middle; padding-left:5%; padding-right:5%" id="isTrendingText"></span>
        </div>

        <div id="resultsMessageContainer">
            <span style="display:table-cell; padding-left:5%; padding-right:5%; padding-top:5%">Here are the top Trends:</span>
            <br>
            <ul id="trendsList"></ul>
        </div>

        <div class="c100 big dark resultsMetric" id="percent">
          <span id="viralityPercentText">25%</span>
          <div class="slice">
            <div class="bar"></div>
            <div class="fill"></div>
          </div>
        </div>




    </div>



    <div id="dataPage">

        <a class="scroll" href="#resultsPage"> back 1 </a> <br>
        <a class="scroll" href="#emotionsPage"> forward 1 </a>


        <div id="leftpart">
            <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%, margin-bottom:20%">Readability:</span>
            <div class= "bars">
                <div class="inneritem" id="readabilityBar"></div>
            </div>

            <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%; margin-bottom:20%">Impactful Words:</span>
            <div class= "bars" >
                <div class="inneritem" id="powerWordsBar"></div>
            </div>

            <span style="display:table-row; vertical-align:middle; margin-left:20%; margin-top:20%; margin-bottom:20%">Links, Emoticons, and Punctuation:</span>
            <div class= "bars" >
                <div class="inneritem" id="emoticonsAndLinksBar"></div>
            </div>

        </div>
        <div id="rightpart">


            <div style="position:static; height:20%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;" id="readabilityResult">Suggestion1</span>
            </div>
            <br></br>

            <div style="position:static;height:20%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;" id="powerWordsResult">Suggestion2</span>
            </div>

            <br></br>
            <div style="position:static;height:20%;border-width: 2px;border-color:rgba(124,119,195,0.8);border-style: solid;">
                <span style=" position:relative;">Suggestion3</span>
            </div>
            <br></br>



                
        </div>

    </div>


    <div id="emotionsPage">

        <a class="scroll" href="#dataPage"> back 1 </a> <br>
        <a class="scroll" href="#topPostsPage"> forward 1 </a>

    </div>






    <div id="topPostsPage">

        <a class="scroll" href="#emotionsPage"> back 1 </a> <br>
        <a class="scroll" href="#inputPage"> forward 1 </a>

        <div id="TitleText">
            <span style="display:table-cell; vertical-align:middle; text-align:center; padding-left:5%; padding-right:5%">Top tweets in your topic!</span>
        </div>

        <div id="tweets">
        <span style=" vertical-align:center; padding-left:5%; padding-bottom:5%; padding-right:5%">"Tweet 1 ...."</span>
    </br>
        <span style=" vertical-align:center; padding-left:5%; padding-bottom:5%; padding-right:5%">"Tweet 2 ...."</span>
        </div>

    </div>






<script src="jquery.min.js"></script>
<script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
<script src="spin.min.js"></script>
<script src="jquery.rotate.1-1.js"></script>
<script src="features.js"></script>
<script src="emojis.js"></script>
<!-- <script src="./bundle.js"></script> -->

<script>

    // SETUP

    // FIREBASE
    var rootRef = "https://sbio2016.firebaseio.com/";
    var trendsRef = rootRef + "trending";
    var trendsFirebase = new Firebase(trendsRef);
    

    // PAGES
    var pageIDs = ["#inputPage", "#resultsPage", "#topPostsPage", "#dataPage", "#emotionsPage"];

    // VARIABLES
    var currInput = "";
    var isTrending = false;
    var coefficients = {};
    var viralityScore = 0;
    var emoticons = splitEmoticonsIntoArrayOfStrings();
    var containsEmoticons = false;
    var containsLinks = false;

   // Smooth scroll
    jQuery(document).ready(function($) {
        $(".scroll").click(function(event){     
            event.preventDefault();
            $('html,body').animate({scrollTop:$(this.hash).offset().top}, 500);
        });
    });


    // Page setup
    function resizeHelper() {
        var winheight = $(window).height();
        var winwidth = $(window).width();

        for (var i = 0; i < pageIDs.length; i++) {
            $(pageIDs[i]).height(winheight);
            $(pageIDs[i]).width(winwidth);
        }
    }

    $(window).on('resize', function(){
        resizeHelper();
    }).trigger('resize');


    window.onload = load();

    function load() {
        console.log("loaded");
        resizeHelper();
        window.scrollTo(0,0);
    }





    // INPUT PAGE

    // Handle tabbing in text area
    // Note this isn't great for blind folks
    // http://stackoverflow.com/questions/6637341/use-tab-to-indent-in-textarea
    $(document).delegate('.textbox', 'keydown', function(e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode == 9) {
        e.preventDefault();
        var start = $(this).get(0).selectionStart;
        var end = $(this).get(0).selectionEnd;

        // set textarea value to: text before caret + tab + text after caret
        $(this).val($(this).val().substring(0, start)
                    + "\t"
                    + $(this).val().substring(end));

        // put caret at right position again
        $(this).get(0).selectionStart =
        $(this).get(0).selectionEnd = start + 1;
      }
    });

    $( "#finishInputButton" ).click(function() {

        // currPostFirebase = new Firebase(firebaseRoot + "/" + n)
        // currPostFirebase.set({"entryPath":n, "entryText": currPostText})

        // $("#overlay").css({'background-color':'transparent'});
        // $("#overlay").show();
        // setTimeout("endLoadingToNewScreen()", (3000));
        showResults();

    });

    function showResults() {
        // Get the data and parse it
        currInput = $("#postInputTextArea").val();
        // alert(currInput);

        // $('#overlay').fadeOut( 400 );
        // var keywordsFound = checkForKeywords();

        // getCurrentPostData();

        // if (!keywordsFound) {
        //     setTimeout("moveToResultsScreen()", 400);
        // }
        logoWiggle();


        setTimeout("moveToResultsPage()", 860);
    
    }

    function moveToResultsPage() {
        if (checkForTrends()) {
            $("#isTrendingText").html("Your post is: <span style=\"color:green; font-weight:bold;\"> trending! </span>");
            isTrending = true;
        } else {
            $("#isTrendingText").html("Your post is: <span style=\"color:red; font-weight:bold;\"> not trending. </span>");
            isTrending = false;
        }
        coefficients = returnCoefficients(currInput);
        checkForLinksAndEmoji();
        setViralityScore();
        setBarValues();
        setResultMessages();

        $('html,body').animate({scrollTop:$("#resultsPage").offset().top}, 500);
    }

    function logoWiggle() {
        smoothRotateLeft(0, 2);
        setTimeout("smoothRotateRight(0, 2)", 160);
        setTimeout("smoothRotateRight(0, 2)", 320);
        setTimeout("smoothRotateLeft(0, 2)", 480);
        setTimeout("smoothRotateLeft(0, 2)", 640);
        setTimeout("smoothRotateRight(0, 2)", 700);
    }

    function smoothRotateLeft(deg, amt) {
        $("#logo").rotateLeft(amt);
        if (deg < 20) {
            deg = deg + 1;
            setTimeout("smoothRotateLeft(" + deg + "," + amt + ")", 2);
            console.log("left: ", amt, " deg: ",deg);
        }
    }
    function smoothRotateRight(deg, amt) {
        $("#logo").rotateRight(amt);
        if (deg < 20) {
            deg = deg + 1;
            setTimeout("smoothRotateRight(" + deg + "," + amt + ")", 2);
            console.log("right: ", amt, " deg: ",deg);
        }
    }


    function moveToResultsScreen() {
        // // set bar graph
        // setBarHeightsForTones(currPostData);
        // setResponseMessage();
        // getInsightsData();
        // // set the message
        // getLastFivePosts();
        // console.log("LAST FIVE POSTS");
        // console.log(lastFiveEntries);
        // generateLineGraph("Anger");

        // $('html,body').animate({scrollTop:$("#entryStatsPage").offset().top}, 500);
        // console.log(currPostData);

        // setTimeout("setPersonalityBarHeights()", 1000);
    }


// $("#resultsMessageContainer span").text(message);



    // Some FIREBASE STUFF
    var trendsAry = [];
    setTimeout("getTrends()", 1000);
    function getTrends() {
        trendsFirebase.once("value", function(snapshot) {
            // alert(JSON.stringify(snapshot.val(), null, 2));
            var trends = snapshot.val();
            for (var ndx in trends) {
                var trend = trends[ndx].name;
                if (trends[ndx].tweet_volume != undefined) {
                   var volume = trends[ndx].tweet_volume;
                }
                else {
                    var volume = "< 10000";
                }
                var link = trends[ndx].url
                var str = "Trend: \"" + "<a target='blank' href='" + link + "'>" + trend + "</a>"+ "\"\nTweet volume: " + volume;
                $("#trendsList").append("<li>" + str+"</li>" + "<br>");
                trendsAry.push(trend);
            }
        });
    }

    //check for trends in the post
    function checkForTrends() {
        var currPost = currInput.toLowerCase();
        var currTrend = "";
        for (var i = 0; i < trendsAry.length; i++) {
            if ((trendsAry[i].charAt(0) == "#") || (trendsAry[i].charAt(0) == "@")) {
                // console.log("trend: ",trendsAry[i], " it was #")
                currTrend = trendsAry[i].substring(1).toLowerCase();
            }
            else {
                currTrend = trendsAry[i].toLowerCase();
            }
            if (currPost.indexOf(currTrend) > -1) {
                return true;
            }
        }
        return false;
    }



    function checkForLinksAndEmoji() {
        for (var i = 0; i < emoticons.length; i++) {
            if (currInput.indexOf(emoticons[i]) > -1) {
                containsEmoticons = true;
            }
        }
        if (containsEmoticons) {
            coefficients["EmoticonsAndLinksScore"] = 5;
            coefficients["EmoticonsAndLinksLevel"] = 33;
        }
        else {
            coefficients["EmoticonsAndLinksScore"] = 0;
            coefficients["EmoticonsAndLinksLevel"] = 0;
        }

        if (new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?").test(currInput)) {
            // alert("url inside");
            coefficients["EmoticonsAndLinksScore"] += 10;
            coefficients["EmoticonsAndLinksLevel"] += 67;
            containsLinks = true;
        }
        else {
            // do nothing
        }


    }

    function setViralityScore() {
        if (isTrending) {
            viralityScore += 20;
        }
        // console.log("\n\n\n\n\n" + coefficients + "\n\n\n\n\n\n");
        viralityScore += coefficients["FKGradeScore"];
        viralityScore += coefficients["PowerWordsScore"];
        viralityScore += coefficients["EmoticonsAndLinksScore"];


        $("#percent").addClass("p" + viralityScore);
        $("#viralityPercentText").text(viralityScore + "%")
    }

    function setBarValues() {
        $("#readabilityBar").css("width",coefficients["FKGradeLevel"].toString() + "%");
        $("#powerWordsBar").css("width",coefficients["PowerWordsLevel"].toString() + "%");
        $("#emoticonsAndLinksBar").css("width",coefficients["EmoticonsAndLinksLevel"].toString() + "%");
    }

    function setResultMessages() {
        setReadabilityMessage();
        setPowerWordsMessage();
    }

    function setReadabilityMessage() {
        if (coefficients.FKGradeScore == 5) {
            var result = "Your post is hard to read.";
            var suggestion = "Try using simpler words!";
        }
        else if (coefficients.FKGradeScore == 10) {
            var result = "Your post is a bit simple.";
            var suggestion = "Try adding some descriptive words!";
        }
        else if (coefficients.FKGradeScore == 15) {
            var result = "Your post is easy to read.";
            var suggestion = "Great job!";
        }
        var str = result.concat("<br><br>" + suggestion);
        $("#readabilityResult").html(str);
    }

    function setPowerWordsMessage() {
        var powerwords = getRandomPowerWords();
        if (coefficients.PowerWordsScore == 0) {
            var result = "Your post needs more impactful words.";
            var suggestion = "Try using some of these: ";
            suggestion = suggestion.concat(powerwords[0]);
            for (var i = 1; i < powerwords.length; i++) {
                suggestion = suggestion.concat(", " + powerwords[i]);
            }
            suggestion = suggestion.concat("!")
        }
        else if (coefficients.PowerWordsScore == 10) {
            var result = "Your post has one impactful word, but it could be better!";
            var suggestion = "Try using some of these: ";
            suggestion = suggestion.concat(powerwords[0]);
            for (var i = 1; i < powerwords.length; i++) {
                suggestion = suggestion.concat(", " + powerwords[i]);
            }
            suggestion = suggestion.concat("!")
        }
        else if (coefficients.PowerWordsScore == 20) {
            var result = "Your post has plenty of impactful words!";
            var suggestion = "You rock!";
        }
        var str = result.concat("<br><br>" + suggestion);
        $("#powerWordsResult").html(str);
    }

    function setLinksAndEmoticonsMessage() {

    }



</script>

</body>
</html>
